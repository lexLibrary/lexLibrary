<!DOCTYPE html>
<html lang="en">

<head>
	[[template "header"]]
	<title>Administration - Lex Library</title>
</head>

<body>
	<div class="page-container">
		[[template "nav" .]]
		<div class="page-content container">
			<h1>Administration</h1>
			<nav class="nav nav-pills nav-justified">
				<a class='nav-item nav-link [[if eq .Tab "overview"]]active[[end]]' href="/admin">Overview</a>
				<a class='nav-item nav-link [[if eq .Tab "users"]]active[[end]]' href="/admin/users">Users</a>
				<a class='nav-item nav-link [[if eq .Tab "registration"]]active[[end]]' href="/admin/registration">Registration</a>
				<a class='nav-item nav-link [[if eq .Tab "logs"]]active[[end]]' href="/admin/logs">Logs</a>
				<a class='nav-item nav-link [[if eq .Tab "settings"]]active[[end]]' href="/admin/settings">Settings</a>
			</nav>
			<div id="admin">
				[[if eq .Tab "overview"]]
					[[template "overview" .]]
				[[else if eq .Tab "users"]]
					[[template "users" .]]
				[[else if eq .Tab "settings"]]
					[[template "settings" .]]
				[[else if eq .Tab "logs"]]
					[[template "logs" .]]
				[[else if eq .Tab "registration"]]
					[[template "registration" .]]
				[[end]]
			</div>
		</div>
		[[template "footer" .]]
	</div>
</body>
<script type="application/json" id="settingsPayload">[[.Settings]]</script>
<script src="/js/vue.js"></script>
<script src="/js/admin.js"></script>
</html>


[[define "overview"]]
<section class="pt-4">
	<div class="row">
		<div class="col text-center">
			<h5 class="title"><small>Users</small></h5>
			<h3>[[.Overview.Instance.Users]]</h3>
		</div>
		<div class="col text-center">
			<h5 class="title"><small>Logged In</small></h5>
			<h3>[[.Overview.Instance.Sessions]]</h3>
		</div>
		<div class="col text-center">
			<h5 class="title"><small>Documents</small></h5>
			<h3>[[.Overview.Instance.Documents]]</h3>
		</div>
	</div>
</section>
<section class="pt-4">
	<div class="card-columns">
		
		<div class="card">
				<div class="card-header">
					<h5 class="card-title">Instance Information</h5>
				</div>
			<div class="card-body">
				[[with .Overview.Instance]]
				<dl class="row">
					<dt class="col-lg-5">Version</dt><dd class="col-lg-7">[[.Version]]</dd>
					<dt class="col-lg-5">Build Date</dt><dd class="col-lg-7">[[time .BuildDate]]</dd>
					<dt class="col-lg-5">Uptime</dt><dd class="col-lg-7"> [[duration .Uptime]]</dd>
					<dt class="col-lg-5">First Launch</dt>
						<dd class="col-lg-7 tooltip tooltip-top" data-tooltip="[[time .FirstLaunch]]">[[since .FirstLaunch]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-8">Errors Since Last Start</dt><dd class="col-lg-4">[[.ErrorsSinceStart]]</dd>
					<dt class="col-lg-8">Total Number of Errors</dt><dd class="col-lg-4">[[.ErrorsTotal]]</dd>
				</dl>
				[[end]]
			</div>
		</div> <!-- card -->

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">Data Usage</h5>
				[[if eq .Overview.Config.DatabaseType "sqlite"]]
					<h6 class="card-subtitle text-muted">Image Size is not available on SQLITE</h6>
				[[else if eq .Overview.Config.DatabaseType "cockroachdb"]]
					<h6 class="card-subtitle text-muted">Data Sizes are not currently availble on Cockroach DB</h6>
				[[end]]
			</div>
			<div class="card-body">
				<dl class="row">
					[[with .Overview.Instance.Size]]
					<dt class="col-lg-6">Database Size</dt><dd class="col-lg-6">[[bytes .Data]]</dd>
					<dt class="col-lg-6">Image Size</dt><dd class="col-lg-6">[[bytes .Image]]</dd>
					<dt class="col-lg-6">Search Index Size</dt><dd class="col-lg-6">[[bytes .Search]]</dd>
					<dt class="col-lg-6">Total Size</dt><dd class="col-lg-6">[[bytes .Total]]</dd>
					[[end]]
					<dt class="col-lg-6">Space Available</dt><dd class="col-lg-6">[[bytes .Overview.System.FreeSpace]]</dd>
				</dl>
			</div>
		</div> <!-- card -->

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">System Information</h5>
			</div>
			<div class="card-body">
				[[with .Overview.System]]
				<dl class="row">
					<dt class="col-lg-5">Uptime</dt><dd class="col-lg-7">[[duration .Uptime]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-5">Total RAM</dt><dd class="col-lg-7">[[bytes .Totalram]]</dd>
					<dt class="col-lg-5">Free RAM</dt><dd class="col-lg-7">[[bytes .Freeram]]</dd>
					<dt class="col-lg-5">Shared RAM</dt><dd class="col-lg-7">[[bytes .Sharedram]]</dd>
					<dt class="col-lg-5">Total Swap</dt><dd class="col-lg-7">[[bytes .Totalswap]]</dd>
					<dt class="col-lg-5">Free Swap</dt><dd class="col-lg-7">[[bytes .Freeswap]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-5">Free Space</dt><dd class="col-lg-7">[[bytes .FreeSpace]]</dd>
					<dt class="col-lg-5">Total Space</dt><dd class="col-lg-7">[[bytes .TotalSpace]]</dd>
				</dl>
				[[end]]
			</div>
		</div> <!-- card -->

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">Runtime</h5>
			</div>
			<div class="card-body">
				[[with .Overview.Runtime]]
				<dl class="row">
					<dt class="col-lg-6">OS</dt><dd class="col-lg-6">[[.OS]]</dd>
					<dt class="col-lg-6">Go Version</dt><dd class="col-lg-6">[[.GoVer]]</dd>
					<dt class="col-lg-6">Architecture</dt><dd class="col-lg-6">[[.Arch]]</dd>
					<dt class="col-lg-6">Compiler</dt><dd class="col-lg-6">[[.Compiler]]</dd>
					<dt class="col-lg-6">Max Procs</dt><dd class="col-lg-6">[[.MaxProcs]]</dd>
					<dt class="col-lg-6">Number of CPUs</dt><dd class="col-lg-6">[[.NumCPU]]</dd>
				</dl>
				[[end]]
			</div>
		</div> <!-- card -->

		<div class="card">
			[[with .WebConfig]]
			<div class="card-header">
				<h5 class="card-title">Web Configuration</h5>
				[[if ne .Location ""]]
				<h6 class="card-subtitle text-muted">
					Values are set in the configuration file.
				</h6>
				<p class="text-muted"><small>[[.Location]]</small></p>
				[[else]]
					<h6 class="card-subtitle text-muted">Values are defaults or set environment variable.</h6>
				[[end]]
			</div>
			<div class="card-body">
				<dl class="row">
					<dt class="col-lg-9">Read Timeout</dt><dd class="col-lg-3">[[.ReadTimeout]]</dd>
					<dt class="col-lg-9">Write Timeout</dt><dd class="col-lg-3">[[.WriteTimeout]]</dd>
					<dt class="col-lg-9">Max Header Bytes</dt><dd class="col-lg-3">[[.MaxHeaderBytes]]</dd>
					<dt class="col-lg-9">Min TLS Version</dt><dd class="col-lg-3">[[.MinTLSVersion]]</dd>
					<dt class="col-lg-9">Max Upload Memory (MB)</dt><dd class="col-lg-3">[[.MaxUploadMemoryMB]]</dd>
					<dt class="col-lg-9">Port</dt><dd class="col-lg-3">[[.Port]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-5">Certificate File</dt><dd class="col-lg-7"><small>[[.CertFile]]</small></dd>
					<dt class="col-lg-5">Key File</dt><dd class="col-lg-7"><small>[[.KeyFile]]</small></dd>
				</dl>
			</div>
			[[end]]
		</div> <!-- card -->

		<div class="card">
			[[with .Overview.Config]]
			<div class="card-header">
				<h5 class="card-title">Data Configuration</h5>
				[[if ne .Location ""]]
				<h6 class="card-subtitle text-muted">
					Values are set in the configuration file.
				</h6>
				<p class="text-muted"><small>[[.Location]]</small></p>
				[[else]]
					<h6 class="card-subtitle text-muted">Values are defaults or set environment variable.</h6>
				[[end]]
			</div>
			<div class="card-body">
				<dl class="row">
					[[if eq .DatabaseType "sqlite"]]
					<dt class="col-lg-5">Data File</dt><dd class="col-lg-7">[[.DatabaseFile]]</dd>
					[[end]]
					<dt class="col-lg-5">Search File</dt><dd class="col-lg-7">[[.SearchFile]]</dd>
					<dt class="col-lg-5">Database Type</dt><dd class="col-lg-7">[[.DatabaseType]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-5">SSL Cert</dt><dd class="col-lg-7">[[.SSLCert]]</dd>
					<dt class="col-lg-5">SSL Key</dt><dd class="col-lg-7">[[.SSLKey]]</dd>
					<dt class="col-lg-5">SSL Root Cert</dt><dd class="col-lg-7">[[.SSLRootCert]]</dd>
					<dt class="col-lg-12"><hr></dt>
					<dt class="col-lg-9">Max Idle Connections</dt><dd class="col-lg-3">[[.MaxIdleConnections]]</dd>
					<dt class="col-lg-9">Max Open Connections</dt><dd class="col-lg-3">[[.MaxOpenConnections]]</dd>
					<dt class="col-lg-9">Max Connection Lifetime</dt><dd class="col-lg-3">[[.MaxConnectionLifetime]]</dd>
				</dl>
			</div>
			[[end]]
		</div> <!-- card -->

	</div> <!-- card-columns -->
</section>
[[end]]


[[define "settings"]]
<section id="settings" class="pt-4">
	<div class="container grid-lg">
		<div class="columns">
			<div class="column col-3">
				<ul class="menu">
					<li class="menu-item">
						<div>
							<h4>Settings</h4>
						</div>
					</li>
					<li class="divider"></li>
					<li class="menu-item">
						<a @click="setPage('security', $event)" href="" :class="{'active': securityActive}">Security</a>
					</li>
					<li class="menu-item">
						<a @click="setPage('documents', $event)" href="" :class="{'active': documentsActive}">Documents</a>
					</li>
					<li class="menu-item">
						<a @click="setPage('web', $event)" href="" :class="{'active': webActive}">Web Server</a>
					</li>
					<li class="menu-item">
						<a @click="setPage('misc', $event)" href="" :class="{'active': miscActive}">Misc</a>
					</li>
					<li class="divider"></li>
					<li class="menu-item">
						<input v-model="search" class="form-input" type="text" id="settingSearch" 
							placeholder="Search Settings">
					</li>
				</ul>
			</div> <!-- column -->
			<div class="ml-8 column">
				<h3 v-if="search" v-cloak>Searching</h3>
				<h3 v-else-if="securityActive" v-cloak>Security</h3>
				<h3 v-else-if="documentsActive" v-cloak>Documents</h3>
				<h3 v-else-if="webActive" v-cloak>Web Server</h3>
				<h3 v-else-if="miscActive" v-cloak>Misc</h3>
				<h6 class="text-gray">Settings take effect immediately unless noted otherwise</h6>

				<form v-if="pages.security.PasswordMinLength" @submit="updateSetting('PasswordMinLength', $event)" 
					v-cloak class="setting-group form-horizontal">
						<div :class="{'has-error': hasError=='PasswordMinLength'}" class="form-group">
							<div class="col-8">
								<label class="form-label" for="PasswordMinLength">Minimum Allowed Password Length</label>
							</div>
							<div class="input-group col-4">
								<input v-model="settings.PasswordMinLength.value" class="form-input" type="number" 
									id="PasswordMinLength" placeholder="Min password length">
								<button type="submit" :class="{loading: isWaiting=='PasswordMinLength'}" 
									class="btn btn-primary input-group-btn">
									Change
								</button>
							</div>
							<p v-if="hasError=='PasswordMinLength'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->

				<form v-if="pages.security.PasswordRequireNumber" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='PasswordRequireNumber'}" class="form-switch" id="PasswordRequireNumber">
							<input v-model="settings.PasswordRequireNumber.value" @change="updateSetting('PasswordRequireNumber')" 
							 type="checkbox" :disabled="isWaiting=='PasswordRequireNumber'">
							<i class="form-icon"></i> Require that all new passwords have at least one number
						</label>
						<p v-if="hasError=='PasswordRequireNumber'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.PasswordRequireSpecial" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='PasswordRequireSpecial'}" class="form-switch" id="PasswordRequireSpecial">
							<input v-model="settings.PasswordRequireSpecial.value" @change="updateSetting('PasswordRequireSpecial')" 
							type="checkbox"	:disabled="isWaiting=='PasswordRequireSpecial'">
							<i class="form-icon"></i> Require that all new passwords have at least one special character
						</label>
						<p v-if="hasError=='PasswordRequireSpecial'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.PasswordRequireMixedCase" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='PasswordRequireMixedCase'}" class="form-switch" 
							id="PasswordRequireMixedCase">
							<input v-model="settings.PasswordRequireMixedCase.value" @change="updateSetting('PasswordRequireMixedCase')" 
							type="checkbox" :disabled="isWaiting=='PasswordRequireMixedCase'">
							<i class="form-icon"></i> Require that all new passwords have at least one upper and one lower case letter
						</label>
						<p v-if="hasError=='PasswordRequireMixedCase'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.BadPasswordCheck" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='BadPasswordCheck'}" class="form-switch" id="BadPasswordCheck">
							<input v-model="settings.BadPasswordCheck.value" @change="updateSetting('BadPasswordCheck')" type="checkbox" 
								:disabled="isWaiting=='BadPasswordCheck'">
							<i class="form-icon"></i> Require that all new passwords aren't in a list of the most common passwords
						</label>
						<p v-if="hasError=='BadPasswordCheck'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.RememberSessionDays" @submit="updateSetting('RememberSessionDays', $event)" 
					v-cloak class="setting-group form-horizontal">
						<div :class="{'has-error': hasError=='RememberSessionDays'}" class="form-group">
							<div class="col-9">
								<label class="form-label" for="RememberSessionDays">How many days a session is valid for if 
									<em>Remember Me</em> is checked when logging in.</label>
							</div>
							<div class="input-group col-3">
								<input v-model="settings.RememberSessionDays.value" class="form-input" type="number" 
									id="RememberSessionDays" placeholder="Days to remember a session">
								<button type="submit" :class="{loading: isWaiting=='RememberSessionDays'}" 
									class="btn btn-primary input-group-btn">
									Change
								</button>
							</div>
							<p v-if="hasError=='RememberSessionDays'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.AllowPublicSignups" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='AllowPublicSignups'}" class="form-switch" id="AllowPublicSignups">
							<input v-model="settings.AllowPublicSignups.value" @change="updateSetting('AllowPublicSignups')" 
							type="checkbox" :disabled="isWaiting=='AllowPublicSignups'">
							<i class="form-icon"></i>Allow anyone to create a login for Lex Library.  If not set, logins can <em>only</em>
							be created from <a href="/admin/registration">Registration Links</a>.
						</label>
						<p v-if="hasError=='AllowPublicSignups'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.security.PasswordExpirationDays" @submit="updateSetting('PasswordExpirationDays', $event)" 
					v-cloak class="setting-group form-horizontal">
						<div :class="{'has-error': hasError=='PasswordExpirationDays'}" class="form-group">
							<div class="col-9">
								<label class="form-label" for="PasswordExpirationDays">Number of days until a user is required to change
									their password. If negative, passwords will never expire. <em>Only impacts new passwords.</em></label>
							</div>
							<div class="input-group col-3">
								<input v-model="settings.PasswordExpirationDays.value" class="form-input" type="number" 
									id="PasswordExpirationDays" placeholder="Days until passwords expire">
								<button type="submit" :class="{loading: isWaiting=='PasswordExpirationDays'}" 
									class="btn btn-primary input-group-btn">
									Change
								</button>
							</div>
							<p v-if="hasError=='PasswordExpirationDays'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->


				<form v-if="pages.documents.AllowPublicDocuments" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='AllowPublicDocuments'}" class="form-switch" id="AllowPublicDocuments">
							<input v-model="settings.AllowPublicDocuments.value" @change="updateSetting('AllowPublicDocuments')" 
							type="checkbox" :disabled="isWaiting=='AllowPublicDocuments'">
							<i class="form-icon"></i> Allow documents to be published 
							<span class="popover popover-right"><em>Publically*</em>
								<div class="popover-container">
									<div class="card">
										<div class="card-body">
											When active, any document without a group will be viewable without a login.
										</div>
									</div>
								</div>
							</span>
						</label>
						<p v-if="hasError=='AllowPublicDocuments'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->

				<form v-if="pages.web.RateLimit" @submit="updateSetting('RateLimit', $event)" 
					v-cloak class="setting-group form-horizontal">
						<div :class="{'has-error': hasError=='RateLimit'}" class="form-group">
							<div class="col-8">
								<label class="form-label" for="RateLimit">Number of requests per minute a unique user or ip address is 
									allowed to make </label>
								<small class="text-gray">Default: 2000</small>
							</div>
							<div class="input-group col-4">
								<input v-model="settings.RateLimit.value" class="form-input" type="number" 
									id="RateLimit" placeholder="Requests per minute">
								<button type="submit" :class="{loading: isWaiting=='RateLimit'}" 
									class="btn btn-primary input-group-btn">
									Change
								</button>
							</div>
							<p v-if="hasError=='RateLimit'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->
				<form v-if="pages.web.URL" @submit="updateSetting('URL', $event)" 
					v-cloak class="setting-group form-horizontal">
						<div :class="{'has-error': hasError=='URL'}" class="form-group">
							<div class="col-4">
								<label class="form-label" for="URL">URL of the Lex Library Instance</label>
							</div>
							<div class="input-group col-8">
								<input v-model="settings.URL.value" class="form-input" type="text" id="URL" placeholder="Lex Library URL">
								<button type="submit" :class="{loading: isWaiting=='URL'}" 
									class="btn btn-primary input-group-btn">
									Change
								</button>
							</div>
							<p v-if="hasError=='URL'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->


				<form v-if="pages.misc.NonAdminIssueSubmission" v-cloak class="setting-group">
					<div class="form-group">
						<label :class="{'is-error': hasError=='NonAdminIssueSubmission'}" class="form-switch" 
							id="NonAdminIssueSubmission">
							<input v-model="settings.NonAdminIssueSubmission.value" @change="updateSetting('NonAdminIssueSubmission')" 
							type="checkbox" :disabled="isWaiting=='NonAdminIssueSubmission'">
							<i class="form-icon"></i> Allow non-admin users to submit issues from the <a href="/about">about page</a>. 
						</label>
						<p v-if="hasError=='NonAdminIssueSubmission'" v-cloak class="form-input-hint">{{error}}</p>
					</div>
				</form> <!-- setting -->

			</div> <!-- column -->
		</div> <!-- columns -->
	</div> <!-- container -->
</section>
[[end]]


[[define "logs"]]
	[[with .Log]]
	<section class="admin-logs pt-4">
		[[if .Entry]]
			[[with .Entry]]
				<h4>Log Entry from [[time .Occurred]] <small class="text-gray">([[.ID]])</small></h4>
				<hr>
				<p>[[.Message]]</p>
			[[end]]
		[[else]]
			<div class="columns">
				<div class="col-sm-12 col-5 centered">
					<form id="logSearch" @submit="search">
						<div class="input-group">
							<input v-model="searchValue" type="text" class="form-input input" placeholder="Search Logs">
							<button type="submit" class="btn btn-primary input-group-btn">Search</button>
						</div>
					</form>
				</div>
			</div>
			<table class="table">
				<thead>
					<tr>
						<th class="date">Date</th>
						<th>Error</th>
						<th class="view-link"></th>
					</tr>
				</thead>
				<tbody>
					[[range .Logs]]
						<tr>
							<td>[[time .Occurred]]</td>
							<td title="[[.Message]]">[[.Message]]</td>
							<td><a class="float-right" href="/admin/logs/[[.ID]]">View</a></td>
						</tr>
					[[end]]
				</tbody>
			</table>
			[[template "pager" .Pager]]
		[[end]]
	</section>
	[[end]]
[[end]]

[[define "registration"]]
	[[with .Registration]]
		[[if .New]]
			[[template "new registration" .]]
		[[else if .Single]]
			[[template "single registration" .Single]]
		[[else]]
		<section class="registration pt-4">
			<a href="/admin/newregistration" class="float-right btn btn-primary">New</a>
			<div class="text-center pb-4">
				<div class="btn-group">
					<a href="/admin/registration" class="btn btn-[[if .All]]outline-[[end]]primary">Active</a>
					<a href="/admin/registration?all" class="btn btn-[[if not .All]]outline-[[end]]primary">All</a>
				</div>
			</div>
			<table class="table">
				<thead>
					<tr>
						<th>Description</th>
						<th class="date">Created</th>
						<th class="creator text-right">Creator</th>
					</tr>
				</thead>
				<tbody>
					[[range .Tokens]]
						<tr class="[[if not .Valid]]active font-italic[[end]]">
							<td><a href="/admin/registration/[[.Token]]">[[.Description]]</a></td>
							<td>[[time .Created]]</td>
							<td class="text-right">[[template "avatar" .Creator]]</td>
						</tr>
					[[end]]
				</tbody>
			</table>
			[[template "pager" .Pager]]
		</section>
		[[end]]
	[[end]]
[[end]]

[[define "new registration"]]
<div id="newRegistration" class="pt-4">
	<div class="row justify-content-center">
		<div class="col-6">
			<h3>Create a Registration URL</h3>
			<h6 class="text-muted">Registration URLs allow new users to sign up for this Lex Library instance when
			public signups are not allowed</h6>

			<div v-if="error" v-cloak class="alert alert-danger">
				{{error}}
				<button type="button" @click="error=null" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form @submit="submit">
				<div class="form-row">
					<div class="form-group col-3">
						<label for="tokenDescription">Description</label>
					</div>
					<div class="form-group col-9">
						<input v-model="description" :class="{'is-invalid': descriptionErr}" class="form-control" type="text" 
							id="tokenDescription" placeholder="Description">
						<div class="invalid-feedback">{{descriptionErr}}</div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-8">
						<div class="form-check">
							<input v-model="hasLimit" class="form-check-input" type="checkbox">
							<label class="form-check-label">Limit the number of users created</label>
						</div>
					</div>
					<div class="form-group col-4">
						<input v-model="limit" :disabled="!hasLimit" :class="{'is-invalid': limitErr}" class="form-control" 
							type="number" placeholder="1">
						<div class="invalid-feedback">{{limitErr}}</div>
					</div>
				</div> <!-- row -->
				<div id="tokenExpiration" class="form-row">
					<div class="form-group col-7">
						<div class="form-check">
							<input v-model="hasExpiration" class="form-check-input" type="checkbox">
							<label class="form-check-label">Valid until a specific date</label>
						</div>
					</div>
					<div class="form-group col-5">
						<input v-model="expires" :disabled="!hasExpiration" :class="{'is-invalid': expireErr}" class="form-control" 
							type="date" placeholder="mm/dd/yyyy">
						<div class="invalid-feedback">{{expireErr}}</div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group">
						<label for="groupSearch">
							When registering with this link, users become members of the following groups:
						</label>
						<div v-cloak class="m-2">
							<span v-for="group in groups" class="badge badge-primary">
								{{group.name}}
								<button type="button" @click="removeGroup(group, $event)" class="close btn-link" aria-label="Close" 
									role="button"></button>
							</span>
						</div>
					</div>
				</div> <!-- row -->
				<div class="form-row">
					<div class="form-group col-3 ">
						<label for="groupSearch">Group Name</label>
					</div>
					<div class="form-group col-9">
						<group-search @select="addGroup" @error="error=$event" maxlength="[[fieldMax `group.name`]]" class="w-100">
						</group-search>
					</div>
				</div> <!-- row -->
				<button type="submit" class="btn btn-primary">Create URL</button>
			</form>
		</div> <!-- col -->
	</div> <!-- row -->
</div>
[[end]]

[[define "single registration"]]
<div id="singleRegistration" class="container grid-lg pt-4">
	<div v-if="error" v-cloak class="mb-4 toast toast-error">
		<button @click="error=null"class="btn btn-clear float-right"></button>
		{{error}}
	</div>

	<div class="columns">
		<div class="column col-8">
			<h4>[[.Description]]</h4>
			<p class="text-gray">Send this URL to whoever needs a login for Lex Library</p>
		</div> <!-- column -->
		<div class="column col-4">
			<div class="tile tile-centered">
				<div class="tile-icon">[[template "avatar" .Creator]]</div>
				<div class="tile-content">
					<div class="tile-title">Created by [[.Creator.DisplayName]]</div>
					[[if .Expires.Valid]]
						<div class="tile-subtitle text-gray" title="[[time .Expires.Time]]">
							Expiration: [[since .Expires.Time]]
						</div>
					[[end]]
					[[if ge .Limit 0]]
						<div class="tile-subtitle text-gray">[[plural .Limit "Registration" ""]] Left</div>
					[[end]]
					<div class="tile-subtitle text-gray">Created on [[time .Created]]</div>
				</div>
			</div>
		</div> <!-- column -->
	</div> <!-- columns -->

	[[if .Valid]]
		<div class="columns pt-4">
			<div class="column">
				<div class="input-group">
					<button @click.stop.prevent="copy" class="input-group-btn btn btn-primary btn-lg">Copy</button>
					<input class="form-input input-lg" type="text" readonly id="registrationUrl" value="[[.URL]]">
				</div>
			</div>
			<div class="column col-2">
				<button @click="invalidate('[[.Token]]')" class="btn btn-error btn-lg">
					<i class="icon icon-delete"></i> Remove
				</button>
			</div>
		</div>
		<p :class="{'show': copied}" class="fade text-gray">Copied to the clipboard</p>
	[[end]]
	<h5>Groups</h5>
	[[range .Groups]]
		<span class="chip"><a href="/group/[[.ID]]">[[.Name]]</a></span>
	[[end]]
	<h5 class="pt-4">Users Registered with this URL</h5>
	<div class="tile-row">
		[[range .Users]]
			<div class="tile tile-centered">
				<div class="tile-icon">
					[[template "avatar" .]]
				</div>
				<div class="tile-content">
					<p class="tile-title">[[.DisplayName]]</p>
					<p class="tile-subtitle text-gray" title="[[time .Created]]">Created [[since .Created]]</p>
				</div>
			</div>
		[[end]]
	</div>
</div>
[[end]]


[[define "users"]]
[[with .Users]]
	[[with .User]]
		<section id="user" class="pt-4">
			<div class="row align-items-center justify-content-center">
				<div class="col-md-auto">
					<a href="/user/[[.Username]]">
						<figure class="avatar avatar-full" data-initial="[[.DisplayInitials]]">
							[[if .ProfileImage]]
								<p-image src="/user/[[.Username]]/image" alt="[[.DisplayName]]">
							[[end]]
						</figure>
					</a>
				</div>
				<div class="col-md-4">
					<div v-if="error" v-cloak class="alert alert-danger">
						{{error}}
						<button type="button" @click="error=null" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<h4>[[.DisplayName]]
						[[if not .Active]] 
							<small class="text-muted"><em>(inactive)</em></small>
						[[else if .IsAdmin]]
							<small class="text-muted">(admin)</small>
						[[end]]
					</h4>
					<h6>Created [[since .Created]] <small class="text-muted">([[time .Created]])</small></h6>
					[[if .LastLogin.Valid]]
					<h6>Last Login [[since .LastLogin.Time]] <small class="text-muted">([[time .LastLogin.Time]])</small></h6>
					[[end]]
				
					<div class="form-group form-check form-check-inline">
						<input class="form-check-input" @input="setActive('[[.Username]]', [[not .Active]])" 
								type="checkbox" [[if .Active]]checked[[end]]>
						<label class="form-check-label">Active</label>
					</div>
					<div class="form-group form-check form-check-inline">
						<input @input="setAdmin('[[.Username]]', [[not .IsAdmin]])" class="form-check-input" type="checkbox"
							[[if .IsAdmin]]checked[[end]]>
						<label class="form-check-label">Admin</label>
					</div>

				</div> <!-- col -->
			</div> <!-- row -->
		</section>
	[[else]]
		<section id="users" class="admin-users pt-4">
			<div class="text-center pb-4">
				<div class="btn-group">
					<a href="/admin/users?active" class="btn btn[[if not .Active]]-outline[[end]]-primary">Active</a>
					<a href="/admin/users?loggedin" class="btn btn[[if not .LoggedIn]]-outline[[end]]-primary">Logged In</a>
					<a href="/admin/users?all" class="btn btn[[if not .All]]-outline[[end]]-primary">All</a>
				</div>
			</div>

			<table class="table">
				<thead>
					<tr>
						<th class="avatar-column"></th>
						<th>
							<form @submit="submit">
								<input @input="search" v-focus class="form-control" type="text" id="userSearch" value="[[.Search]]" 
									placeholder="Search Users">
							</form>
						</th>
						<th class="date">Created</th>
						<th class="date">Last Login</th>
					</tr>
				</thead>
				<tbody>
					[[range .Users]]
						<tr class="[[if not .Active]]table-active font-italic[[end]]">
							<td><a href="/user/[[.Username]]">[[template "avatar" .]]</a></td>
							<td>
								<a href="/admin/users/[[.Username]]">[[.DisplayName]]</a>
								[[if .IsAdmin]]<small>(admin)</small>[[end]]
							</td>
							<td>[[time .Created]]</td>
							<td>[[if .LastLogin.Valid]][[time .LastLogin.Time]][[end]]</td>
						</tr>
					[[end]]
				</tbody>
			</table>
			[[template "pager" .Pager]]
		</section>
	[[end]]
[[end]]
[[end]]
