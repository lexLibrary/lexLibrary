version: '3'
services:
  webdriver:
    image: selenium/standalone-firefox:3.11
    shm_size: '2gb'
    logging:
        driver: "none"
  tests:
    build: "../build"
    links:
      - webdriver
    volumes:
      - ../..:/in:ro
      - ../..:/out
    environment:
      LLTEST: 'true'
      LLDATABASE: 'sqlite'
      LLPORT: 8080
      LLHOST: "tests"
      LLWEBDRIVERURL: "http://webdriver:4444/wd/hub"
      GOPATH: /go
      LLBROWSER: 'firefox'
      LLERRSCREENPATH: "/out/"
    command: 
      - /bin/sh
      - -c
      - |
        mkdir -p /go/src/github.com/lexLibrary/
        cp /in /go/src/github.com/lexLibrary/lexLibrary -R
        cd /go/src/github.com/lexLibrary/lexLibrary/ 
        ./build.sh
        go test ./data -coverprofile=data.cover 
        go tool cover -html=data.cover -o /in/data.html
        go test ./app -coverprofile=app.cover
        go tool cover -html=app.cover -o /in/app.html
        go test ./web -coverprofile=web.cover
        go tool cover -html=web.cover -o /in/web.html
